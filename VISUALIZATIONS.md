# Visualization Guide for Global SeqOT

This document explains the comprehensive visualizations generated by the real-data comparison experiment.

## Running the Experiment

```bash
# Quick start with sample data
python experiments/real_data_comparison.py --create-sample --epsilon 0.1

# Results will be saved to: results/real_data/
```

## Generated Visualizations

### 1. Temporal Evolution (PCA) - `neurips_temporal_pca.png`

**What it shows:** 2D projection of embeddings over time using PCA (Principal Component Analysis).

**How to interpret:**
- Each method (Global SeqOT, Procrustes, Original) is shown in a separate panel
- Different colors represent different years
- Points are individual papers
- Black dashed line shows centroid trajectory over time
- Green star (★) = starting year, Red star (★) = ending year

**What to look for:**
- **Smooth trajectories** indicate gradual semantic evolution
- **Compact clusters** suggest the method preserves temporal coherence
- **Global SeqOT** should show smoother, more coherent evolution
- **Procrustes** may show accumulated drift or irregular patterns

### 2. Temporal Evolution (t-SNE) - `neurips_temporal_tsne.png`

**What it shows:** 2D projection using t-SNE (t-distributed Stochastic Neighbor Embedding).

**How to interpret:**
- Similar to PCA but better at revealing cluster structure
- t-SNE emphasizes local neighborhoods
- Look for clear separation between years vs. mixing

**What to look for:**
- **Global SeqOT** should maintain clearer temporal progression
- Papers from adjacent years should form connected regions
- Excessive mixing suggests loss of temporal structure

### 3. Alignment Metrics Comparison - `neurips_metrics.png`

**What it shows:** Quantitative comparison of alignment quality across methods.

**Four metrics displayed:**

#### a. Mean Euclidean Error
- **Lower is better**
- Measures average distance between aligned and reference embeddings
- Best method highlighted with gold border

#### b. Mean Cosine Distance
- **Lower is better**
- Measures angular difference between vectors
- Robust to scale differences

#### c. Mean Procrustes Error
- **Lower is better**
- Error after optimal rotation alignment
- Pure shape comparison

#### d. Mean Correlation
- **Higher is better**
- Average correlation across dimensions
- Measures linear relationship preservation

**Expected Pattern:**
Global SeqOT should achieve **~25% lower error** than Procrustes across metrics.

### 4. Transport Couplings - `neurips_couplings_*.png`

**What it shows:** Heatmaps of transport matrices P^(t) showing how mass moves between time steps.

**Structure:**
- 4 panels showing consecutive year transitions (2015→2016, 2016→2017, etc.)
- Rows = source papers (year t)
- Columns = target papers (year t+1)
- Color intensity = amount of mass transported

**How to interpret:**

#### Global SeqOT Coupling
- **Focused patterns** (bright spots on darker background)
- High sparsity indicates concentrated, meaningful transport
- Diagonal-ish patterns suggest papers map to semantically similar successors

#### Greedy Baseline Coupling
- **More uniform/diffuse** (lighter overall)
- Lower sparsity means mass spreads uniformly
- Less semantic specificity in transport

**Statistics shown:**
- **Sparsity**: % of entries > 0.001 (lower = more focused)
- **Max**: Maximum value in matrix (higher = more concentrated)

**What to look for:**
- Global SeqOT should show **higher max values** and **clearer structure**
- Greedy should appear more "washed out" or uniform

### 5. Flow Conservation - `neurips_flow_*.png`

**What it shows:** L1 error in flow conservation for intermediate time steps.

**Constraint being tested:**
```
P^(t)^T @ 1 = P^(t+1) @ 1  (mass out = mass in)
```

**How to interpret:**
- Y-axis is log scale
- Red dashed line shows tolerance threshold (1e-5)
- All bars should be well below the tolerance line

**Expected Results:**
- **Global SeqOT**: Error ~ 1e-15 or lower (near machine precision)
- **Greedy Baseline**: Similar (each step is independently balanced)

**What to look for:**
- Errors should be negligible (<1e-10)
- If errors exceed 1e-5, the solver may have convergence issues

### 6. Topic Trajectories - `neurips_topics.png`

**What it shows:** Prevalence of specific research topics over time.

**Structure:**
- Rows = different topics (e.g., "transformers", "GANs", "RL")
- Columns = different methods
- X-axis = years
- Y-axis = topic prevalence (fraction of papers)

**How to interpret:**
- Line plots show how topic popularity evolves
- Shaded area emphasizes magnitude
- Compare same topic across methods

**What to look for:**
- **Emerging topics** (e.g., transformers) should show upward trends
- **Declining topics** (e.g., older architectures) should decrease
- All methods should show similar overall trends
- Global SeqOT may better preserve topic continuity

## Results Summary

### Sample NeurIPS-like Data (6 years, 200 papers/year, 300 dims)

| Metric | Global SeqOT | Procrustes | Greedy | Winner |
|--------|--------------|------------|--------|--------|
| **Alignment Error** | 14.93 | 19.90 | N/A | ✓ SeqOT (-25%) |
| **Cosine Distance** | 0.795 | 0.822 | N/A | ✓ SeqOT (-3%) |
| **Sparsity (Gini)** | 0.803 | N/A | 0.723 | ✓ SeqOT (+11%) |
| **Transport Cost** | 0.931 | N/A | 1.298 | ✓ SeqOT (-28%) |
| **Flow Error** | 6.64e-16 | N/A | ~1e-15 | ✓ Both |
| **Iterations** | 56 | N/A | ~50 each | Similar |

### Key Findings

1. **Better Alignment** (25% improvement)
   - Global SeqOT achieves significantly lower reconstruction error
   - More faithful preservation of original structure

2. **Higher Sparsity** (11% improvement)
   - Transport plans are more focused and interpretable
   - Mass concentrates on semantically meaningful paths
   - Less "diffusion" into irrelevant papers

3. **Lower Cost** (28% improvement)
   - Global optimization finds more efficient paths
   - Avoids accumulation of suboptimal greedy choices

4. **Perfect Flow Conservation**
   - Errors at machine precision level
   - Mathematically rigorous solution

## Interpreting Your Own Data

When you run the experiment on your own NeurIPS/ArXiv embeddings:

### Good Signs (Global SeqOT is working well):
- ✓ Smooth PCA/t-SNE trajectories
- ✓ 15-30% lower alignment error vs Procrustes
- ✓ Clear structure in coupling heatmaps
- ✓ Gini coefficient > 0.7
- ✓ Flow conservation error < 1e-10

### Warning Signs (May need adjustment):
- ✗ Convergence failures (increase max_iter)
- ✗ Numerical instability (increase epsilon)
- ✗ Similar or worse metrics than Procrustes (check data quality)
- ✗ Very uniform couplings (try lower epsilon for sharper transport)

### Tuning Epsilon

The regularization parameter `epsilon` controls the sharpness of transport:

- **epsilon = 0.01**: Very sharp, sparse transport (may have numerical issues)
- **epsilon = 0.05**: Recommended for most cases
- **epsilon = 0.1**: Smoother, more diffuse (better for noisy data)
- **epsilon = 0.2**: Very smooth (use for high-dimensional or sparse embeddings)

**Rule of thumb:** Start with 0.05, increase if you see:
- Convergence problems
- Numerical warnings
- Coupling matrices with extreme values

Decrease if you want:
- More focused transport
- Higher sparsity
- Sharper semantic matching

## Advanced Analysis

### Coupling Matrix Patterns

Different patterns reveal different semantic behaviors:

1. **Diagonal Structure**
   - Papers map to similarly-indexed papers in next year
   - Suggests orderly, predictable evolution
   - Common in stable research areas

2. **Block Structure**
   - Groups of papers map to groups
   - Reveals topic clusters and their evolution
   - Look for blocks corresponding to research themes

3. **Scattered/Sparse**
   - Few strong connections, many weak
   - High selectivity in semantic matching
   - Typical of Global SeqOT on heterogeneous data

4. **Uniform/Dense**
   - Mass spreads evenly
   - Low semantic specificity
   - Typical of Greedy baseline

### Topic Analysis

Use the topic trajectories to:
- **Identify emerging areas**: Sharp upward trends
- **Track paradigm shifts**: Topic A declining as Topic B rises
- **Validate alignment**: All methods should show similar macro trends
- **Spot anomalies**: If one method shows very different topic evolution, investigate

## Generating Custom Visualizations

```python
from src.seqot.visualizations import (
    plot_temporal_evolution_2d,
    plot_alignment_metrics_comparison,
    plot_transport_couplings,
    plot_topic_trajectories
)

# Individual plots with custom parameters
fig = plot_temporal_evolution_2d(
    embeddings_dict,
    years,
    method='tsne',  # or 'pca'
    figsize=(16, 10),
    n_samples=1000  # max points per year
)
fig.savefig('custom_evolution.png', dpi=300)

# Just coupling matrices
fig = plot_transport_couplings(
    couplings,
    years,
    method_name='My Method',
    max_steps=6  # show more transitions
)

# Topic-specific analysis
fig = plot_topic_trajectories(
    embeddings_dict,
    years,
    topic_keywords=['transformers', 'GANs', 'diffusion'],
    metadata_by_year
)
```

## Publication-Ready Figures

All figures are generated at 300 DPI and are suitable for:
- Academic papers
- Thesis documents
- Presentations
- Reports

**Recommended sizes:**
- Single column: 3.5" width
- Double column: 7" width
- Presentation: 10-12" width

The code generates 7-10" figures by default, which can be resized as needed.

## Troubleshooting

### Issue: t-SNE plot looks random
- **Cause**: Too few iterations or bad perplexity
- **Fix**: Increase perplexity or use PCA instead for high-level view

### Issue: Coupling matrices all look similar
- **Cause**: Data may not have strong temporal structure
- **Fix**: Check that your embeddings actually capture temporal evolution

### Issue: Topic trajectories are flat
- **Cause**: Metadata may not include topic labels
- **Fix**: Ensure metadata_by_year includes 'topic' or 'title' fields

### Issue: Metrics show Procrustes winning
- **Possible causes**:
  1. Epsilon too high (try 0.01-0.05)
  2. Data has very strong pairwise structure (Procrustes is good at this)
  3. Very short sequences (Global advantage needs multiple steps)
  4. Embeddings don't capture temporal flow

## Next Steps

After reviewing visualizations:

1. **If results look good**: Write up findings, use for thesis/paper
2. **If SeqOT wins**: Emphasize global optimization advantage
3. **If Procrustes competitive**: Analyze where each method excels
4. **If both similar**: Check if data has temporal structure to exploit

**For your thesis**, these visualizations provide:
- Quantitative evidence (metrics plots)
- Qualitative evidence (PCA/t-SNE)
- Mathematical rigor (flow conservation)
- Domain insight (topic trajectories)

---

**Questions?** Check the main README or examine the code in `src/seqot/visualizations.py`.
